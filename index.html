<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Velk-X</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0c1210; --panel:#0f1814; --panel2:#111e18; --text:#eaf7ef; --muted:#a8cdbb; --border:#1c2c24;
    --brand:#22c55e; --brand2:#16a34a; --brand3:#86efac; --ring:0 0 0 4px rgba(34,197,94,.28);
    --danger:#ef4444; --shadow1:0 10px 30px rgba(0,0,0,.35); --shadow2:0 18px 60px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0;color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:
      radial-gradient(1300px 700px at -10% -10%, #101a15 0%, var(--bg) 60%),
      radial-gradient(900px 500px at 120% 0%, #0e1713 0%, var(--bg) 60%);
  }

  /* Topbar */
  .topbar{height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;border-bottom:1px solid #0e1512;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));backdrop-filter:blur(8px)}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{height:26px;width:26px;border-radius:8px;background:linear-gradient(135deg,var(--brand3),var(--brand2));overflow:hidden}
  .logo img{width:100%;height:100%;object-fit:cover;display:block}
  .title{font-weight:800;letter-spacing:.4px}
  .controls{display:flex;gap:8px;align-items:center}

  .pill{display:inline-flex;align-items:center;gap:8px;height:34px;padding:0 12px;border-radius:999px;border:1px solid var(--border);background:var(--panel2);font-weight:700}
  .dot{width:8px;height:8px;border-radius:999px;background:var(--brand3);box-shadow:0 0 10px rgba(134,239,172,.6)}
  .pill small{color:var(--muted);font-weight:600}

  /* Buttons / Inputs */
  .btn,.btn-ghost{display:inline-flex;align-items:center;justify-content:center;gap:8px;height:40px;padding:0 14px;border-radius:12px;border:1px solid transparent;cursor:pointer;font-weight:700;transition:transform .06s,filter .18s,border-color .18s,background .18s}
  .btn{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#0a0f0c;box-shadow:0 1px 0 rgba(0,0,0,.12)}
  .btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)}
  .btn-ghost{background:var(--panel);color:var(--text);border-color:var(--border)} .btn-ghost:hover{background:var(--panel2)}
  .btn.small{height:34px;padding:0 10px;border-radius:10px;font-weight:600}

  .input{width:100%;height:48px;border-radius:14px;border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));color:var(--text);padding:0 46px 0 14px;transition:border-color .18s,box-shadow .18s,background .18s}
  .input::placeholder{color:var(--muted)} .input:focus{outline:none;border-color:var(--brand);box-shadow:var(--ring);background:var(--panel2)}
  .input-wrap{position:relative}
  .eye{position:absolute;right:8px;top:50%;transform:translateY(-50%);display:inline-flex;align-items:center;justify-content:center;width:34px;height:34px;border-radius:10px;border:1px solid var(--border);background:var(--panel);cursor:pointer}

  /* Gate */
  .wrap{min-height:calc(100% - 56px);display:flex;align-items:center;justify-content:center;padding:32px}
  .card{width:100%;max-width:520px;background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid var(--border);border-radius:24px;padding:28px;position:relative;overflow:hidden;box-shadow:var(--shadow2);backdrop-filter:blur(8px);animation:cardIn .5s ease both}
  @keyframes cardIn{from{transform:translateY(8px);opacity:0}to{transform:none;opacity:1}}
  h1{margin:0 0 8px;font-size:28px;letter-spacing:.2px}
  .subtitle{margin:0;color:var(--muted);font-size:14px}
  .err{color:var(--danger);font-weight:700;font-size:13px;min-height:18px}

  /* Picker */
  .player{display:none}
  .grid{--cols:1;display:grid;gap:18px;padding:18px;grid-template-columns:repeat(var(--cols),minmax(0,1fr))}
  @media(min-width:680px){.grid{--cols:2}} @media(min-width:1024px){.grid{--cols:3}}
  .site{position:relative;border:1px solid var(--border);border-radius:18px;overflow:hidden;background:var(--panel);transition:transform .18s,box-shadow .18s,border-color .18s;box-shadow:var(--shadow1)}
  .site:hover{transform:translateY(-3px);border-color:#214e39;box-shadow:0 18px 44px rgba(0,0,0,.42)}
  .thumb{aspect-ratio:16/9;background:#0a0f0c;overflow:hidden;position:relative}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block;transform:scale(.985);transition:transform .35s ease}
  .site:hover .thumb img{transform:scale(1.02)}
  .gloss{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0) 35%,rgba(0,0,0,.55) 100%)}
  .meta{position:absolute;left:12px;right:12px;bottom:12px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .name{font-weight:800;letter-spacing:.2px;text-shadow:0 2px 10px rgba(0,0,0,.6)}
  .open{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#0b0f0c;font-weight:800;padding:8px 12px;border-radius:10px;border:1px solid #133321}
</style>
</head>
<body>

<!-- Topbar -->
<div class="topbar">
  <div class="brand">
    <div class="logo" id="logoBox"></div>
    <div class="title">Velk-X</div>
  </div>
  <div class="controls">
    <span class="pill" id="reqPill" title="Total Requests (pageviews)">
      <span class="dot"></span>
      <span id="reqCount">‚Äî</span>
      <small>requests</small>
    </span>
    <button class="btn small" id="openDirect" style="display:none">Open here</button>
    <button class="btn-ghost small" id="toPicker" style="display:none">Site Picker</button>
  </div>
</div>

<!-- Gate -->
<div class="wrap" id="gate">
  <div class="card" id="gateCard">
    <h1>Enter Velk-X</h1>
    <p class="subtitle">Type the password.</p>
    <div class="input-wrap" style="margin-top:16px">
      <input id="pw" class="input" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <button type="button" class="eye" id="toggleEye" aria-label="Show password">üëÅÔ∏è</button>
    </div>
    <button class="btn" id="enterBtn" style="width:100%; margin-top:14px">Enter</button>
    <div class="err" id="err" style="margin-top:8px"></div>
  </div>
</div>

<!-- Player -->
<div class="player" id="player">
  <div id="picker" class="grid"></div>
  <iframe id="frame" referrerpolicy="no-referrer" style="display:none;width:100%;height:calc(100vh - 56px);border:0;background:#000"></iframe>
</div>

<script>
  // === CONFIG ===
  const PASSWORD     = "test";
  const FAIL_REDIRECT= "https://example.com/";
  const IMAGE_BASE   = "https://raw.githubusercontent.com/thebronx132/velk-x/main/images/";
  const API_BASE     = "https://velk-x-api.onrender.com"; // your Render API (Firestore-backed)

  // Catalog
  const SITES = [
    { name:"selenite",  url:"https://sixsevenn.alcrb.ru/",      img: IMAGE_BASE+"selenite.png" },
    { name:"MDN",       url:"https://developer.mozilla.org/",   img: IMAGE_BASE+"mdn.jpg" },
    { name:"Wikipedia", url:"https://en.wikipedia.org/",        img: IMAGE_BASE+"wikipedia.jpg" }
  ];

  // === DOM refs ===
  const gate   = document.getElementById('gate');
  const player = document.getElementById('player');
  const picker = document.getElementById('picker');
  const frame  = document.getElementById('frame');
  const toPickerBtn = document.getElementById('toPicker');
  const openDirect  = document.getElementById('openDirect');
  const logoBox = document.getElementById('logoBox');
  const reqCountEl = document.getElementById('reqCount');

  // === helpers ===
  function setLogo(){
    logoBox.innerHTML=''; const img=document.createElement('img');
    img.src=IMAGE_BASE+'velk-x.png'; img.alt='Velk-X'; img.loading='lazy'; logoBox.appendChild(img);
  }
  function show(view){
    gate.style.display   = (view==='gate')   ? 'flex'  : 'none';
    player.style.display = (view==='player') ? 'block' : 'none';
  }

  // === Gate ===
  const pwInput=document.getElementById('pw');
  const errEl=document.getElementById('err');
  const enterBtn=document.getElementById('enterBtn');
  const toggleEye=document.getElementById('toggleEye');
  let attempts=0;
  toggleEye.addEventListener('click', ()=>{ const t=pwInput.type==='password'?'text':'password'; pwInput.type=t; toggleEye.textContent=(t==='text'?'üôà':'üëÅÔ∏è'); pwInput.focus(); });
  function err(msg){ errEl.textContent=msg; document.getElementById('gateCard').animate([{transform:'translateX(0)'},{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:160,iterations:1}); }
  function clearErr(){ errEl.textContent=''; }
  function tryEnter(){
    clearErr();
    if ((pwInput.value||'').trim() === PASSWORD){ startPlayer(); return; }
    attempts++; if (attempts>=2){ err('Too many attempts. Redirecting‚Ä¶'); const w=window.open(FAIL_REDIRECT,'_blank','noopener,noreferrer'); if(!w) alert('Popup blocked.'); }
    else err('Incorrect password. Try again.');
  }
  enterBtn.addEventListener('click', tryEnter);
  pwInput.addEventListener('keydown', e=>{ if(e.key==='Enter') tryEnter(); });

  // === Picker ===
  function card(site){
    const el=document.createElement('div');
    el.className='site';
    el.innerHTML = `
      <div class="thumb">
        <img alt="">
        <div class="gloss"></div>
        <div class="meta">
          <div class="name">${site.name}</div>
          <button class="open">Open</button>
        </div>
      </div>`;
    const img=el.querySelector('img'); img.src=site.img; img.alt=site.name; img.loading='lazy';
    const open=()=>openSite(site.url);
    el.querySelector('.open').addEventListener('click', open);
    el.addEventListener('click', e=>{ if(!e.target.closest('.open')) open(); });
    return el;
  }
  function renderPicker(){
    picker.innerHTML=''; SITES.forEach(s=>picker.appendChild(card(s)));
    picker.style.display='grid'; frame.style.display='none';
    toPickerBtn.style.display='inline-flex'; openDirect.style.display='none';
  }

  // === Player flow ===
  let selectedURL=null; let heartbeat=null; const sid=`${Date.now()}-${Math.random().toString(36).slice(2,8)}`;
  function openSite(url){
    selectedURL=url; frame.src=url; frame.style.display='block'; picker.style.display='none';
    toPickerBtn.style.display='inline-flex'; openDirect.style.display='inline-flex';
    let loaded=false; const onLoad=()=>{loaded=true; frame.removeEventListener('load', onLoad);};
    frame.addEventListener('load', onLoad); setTimeout(()=>{ if(!loaded) openDirect.textContent='Open here (embed blocked)'; }, 2500);
  }
  document.getElementById('toPicker').addEventListener('click', renderPicker);
  document.getElementById('openDirect').addEventListener('click', ()=>{ if(selectedURL) location.href=selectedURL; });

  function startPlayer(){
    setLogo(); show('player'); renderPicker();
    // analytics pings
    ping('/visit',{sid}); ping('/pageview',{sid, path:'home'});
    heartbeat=setInterval(()=> ping('/beat',{sid}), 15000);
    window.addEventListener('beforeunload', ()=> navigator.sendBeacon?.(`${API_BASE}/leave`, JSON.stringify({sid})));
    // stats fetch loop
    updateRequests(); setInterval(updateRequests, 30000);
  }

  // === ‚ÄúTotal Requests‚Äù (pageviews) ===
  async function updateRequests(){
    if (!API_BASE) return;
    try{
      const r = await fetch(`${API_BASE}/stats?days=7`, { cache: 'no-store' });
      const j = await r.json();
      const n = Number(j.pageviews || 0);
      reqCountEl.textContent = isNaN(n) ? '‚Äî' : n.toLocaleString();
    }catch{
      reqCountEl.textContent = '‚Äî';
    }
  }

  // === Optional analytics helper ===
  async function ping(path, body){
    if(!API_BASE) return;
    try { await fetch(`${API_BASE}${path}`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body) }); } catch {}
  }

  // boot
  show('gate'); // start on gate
</script>
</body>
</html>
